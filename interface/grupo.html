<!DOCTYPE html>
<html lang="en">

<head>
  <title>GameXP - Art Street</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/eel.js"></script>

  <style>
    /* Set height of the grid so .sidenav can be 100% (adjust if needed) */
    .row.content {
      height: 1500px
    }

    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }

    /* Set black background color, white text and some padding */
    footer {
      background-color: #555;
      color: white;
      padding: 15px;
    }

    /* On small screens, set height to 'auto' for sidenav and grid */
    @media screen and (max-width: 767px) {
      .sidenav {
        height: auto;
        padding: 15px;
      }

      .row.content {
        height: auto;
      }
    }
  </style>
</head>

<body>

  <div class="container-fluid">
    <div class="row content">
      <div class="col-sm-3 sidenav">
        <h4>Art Street </h4>
        <ul class="nav nav-pills nav-stacked">
          <li><a href="index.html">Home</a></li>
          <li class="active"><a href="grupo.html">Grupo Artístico</a></li>
          <!-- <li><a href="#section3">Family</a></li>
        <li><a href="#section3">Photos</a></li> -->
        </ul><br>
      </div>

      <div class="col-sm-9">
        <h4><small>Consultas, Inserções e Remoções em Grupo Artístico</small></h4>
        <hr>
        <div>
          <h2>Inserção</h2>
          <hr>
          <form onsubmit="insert_tuplas()">
            <div class="form-group">
              <label for="nome"></label>
              <input id="nome_grupo" required type="nome" class="forms form-control" id="nome_cadastro"
                placeholder="nome artistico" name="nome">

              <label for="email"></label>
              <input id="email_grupo" required type="email" class="forms form-control" id="email_cadastro"
                placeholder="e-mail" name="e-mail">

              <label for="descricao"></label>
              <input id="descricao_grupo" required type="text" class="forms form-control" id="descricao_cadastro"
                placeholder="breve descricao" name="descricao">

              <label for="qtd_artista"></label>
              <input id="qtd_grupo" required type="number" class="forms form-control" id="qtd_cadastro"
                placeholder="qtd de artistas" name="qtd_artista">

              <label for="facebook"></label>
              <input id="facebook_grupo" type="text" class="forms form-control" id="fb_cadastro" placeholder="facebook"
                name="facebook">

              <label for="instagram"></label>
              <input id="instagram_grupo" type="text" class="forms form-control" id="ig_cadastro" placeholder="instagram"
                name="instagram">

              <label for="twitter"></label>
              <input id="twitter_grupo" type="text" class="forms form-control" id="tt_cadastro" placeholder="twitter"
                name="twitter">

              <label for="foto"></label>
              <input id="img_grupo" required type="text" class="forms form-control" id="img_cadastro" placeholder="foto"
                name="foto">



              <button type="submit">inserir</button>
            </div>
          </form>
          <hr>
          <h2>Remoção via Nome Artístico</h2>
          <hr>
          <form onsubmit="delete_tuplas()">
            <div class="form-group">
              <label for="nome"></label>
              <input id="nome_delete_grupo" required type="nome" class="forms form-control" id="nome_cadastro"
                placeholder="nome artistico" name="nome">
            </div>
            <button type="submit">remover</button>
          </form>
          <hr>
          <h2>Consulta</h2>
          <hr>
          <button id="listar-button" onclick="get_tuplas()">listar</button>
          <table id="table">
          </table>
          <hr>
          <h2>Atualização</h2>
          <hr>
          <form onsubmit="atualiza_tuplas()">
            <div class="form-group">
              <label for="nome"></label>
              <input id="nome_grupo_2" required type="nome" class="forms form-control" id="nome_cadastro"
                placeholder="nome artistico" name="nome">

              <label for="email"></label>
              <input id="email_grupo_2" required type="email" class="forms form-control" id="email_cadastro"
                placeholder="e-mail" name="e-mail">

              <label for="descricao"></label>
              <input id="descricao_grupo_2" required type="text" class="forms form-control" id="descricao_cadastro"
                placeholder="breve descricao" name="descricao">

              <label for="qtd_artista"></label>
              <input id="qtd_grupo_2" required type="number" class="forms form-control" id="qtd_cadastro"
                placeholder="qtd de artistas" name="qtd_artista">

              <label for="facebook"></label>
              <input id="facebook_grupo_2" type="text" class="forms form-control" id="fb_cadastro" placeholder="facebook"
                name="facebook">

              <label for="instagram"></label>
              <input id="instagram_grupo_2" type="text" class="forms form-control" id="ig_cadastro" placeholder="instagram"
                name="instagram">

              <label for="twitter"></label>
              <input id="twitter_grupo_2" type="text" class="forms form-control" id="tt_cadastro" placeholder="twitter"
                name="twitter">

              <label for="foto"></label>
              <input id="img_grupo_2" required type="text" class="forms form-control" id="img_cadastro" placeholder="foto"
                name="foto">



              <button type="submit">atualizar</button>
            </div>
          </form>
        </div>






      </div>
    </div>
  </div>

  <footer class="container-fluid">
    <p>Projeto 3 - GameXP. Realizado por Pedro Natali, Matheus Arataque, Samira Mendes e Nelson Neto</p>
  </footer>

</body>
<script>
  async function atualiza_tuplas() {

    //Função para pegar os valores colocados no forms de cada atributo
    let name = document.getElementById("nome_grupo_2").value;
    let email = document.getElementById("email_grupo_2").value;
    let desc = document.getElementById("descricao_grupo_2").value;
    let qtd = document.getElementById("qtd_grupo_2").value;

    // Para as redes sociais, foi utilizado um ternário para colocar null caso o valor tenha sido deixado vazio
    let facebook = document.getElementById("facebook_grupo_2").value;
    facebook = true ? facebook : 'None';
    let instagram = document.getElementById("instagram_grupo_2").value;
    instagram = true ? instagram : 'None';
    let twitter = document.getElementById("twitter_grupo_2").value;
    twitter = true ? twitter : 'None';
    let foto = document.getElementById("img_grupo_2").value;

    //Insere os valores dentro da array values
    values = [name, desc, facebook, instagram, twitter, email, qtd, foto];

    //Array com os nomes de cada coluna
    columns = ["NOME_ARTISTICO", "BREVE_DESCRICAO", "FACEBOOK",
      "INSTAGRAM", "TWITTER", "EMAIL", "QUANTIDADE_ARTISTA",
      "FOTO"
    ];

    //Nome da cluna da chave primária e em valor_condicao o nome identificador do grupo 
    coluna_condicao = ["NOME_ARTISTICO"];
    valor_condicao = [name];

    //Chamador da função atualiza
    let success = await eel.update("GRUPO_ARTISTICO", columns, values, coluna_condicao, valor_condicao)();

    //Retorno para sucesso ou erro
    if (success == -1) {
      alert("Erro ao atualizar o registro, tente novamente");
    } else {
      alert('Atualizado com sucesso!')
    }

  }


  let bool = false; //foi usado uma booleana para a funcionalidade de mostrar e esconder do botão de listar as tuplas
  async function get_tuplas() {

    //Declaração das variaveis de vao editar a tabela e do que vai receber as ações no botão
    const table = document.getElementById("table");
    const button = document.getElementById('listar-button');

    //Nome das colunas 
    columns = ["Nome Artístico", "Breve Descrição", "Facebook",
      "Instagram", "Twitter", "E-mail", "Quantidade de Artistas",
      "Foto(url)"
    ];
    if (!bool) { //Quando a booleana é falsa, o clique no botão mostra a tabela

      //Função que seleciona todas linhas de grupo artístico
      let array = await eel.select("GRUPO_ARTISTICO")();
      const columns_size = columns.length; //recebe a quantidade de colunas da tabela

      
      //Função para escrever as colunas no cabeçalho da tabela
      const header = table.createTHead();
      const row = header.insertRow(0);
      for (let i = 0; i < columns_size; i++) {
        var cell0 = row.insertCell(i);
        cell0.innerHTML = "<b>" + columns[i] + "<b>";
      }


      //Função para escrever as linhas da tabela grupo_artístico
      let array2 = [];

      if (array.length > 0) {
        for (var i = 0; i < array.length; i++) {
          // create a new row
          var newRow = table.insertRow(table.length);
          for (var j = 0; j < columns_size; j++) {
            array2 = array[i].split(',');

            // create a new cell
            var cell = newRow.insertCell(j);
            // add value to the cell
            cell.innerHTML = array2[j];
          }
        }
      } else {
        alert("Não há dados armazenados"); 
      }
      //Altera o botão 'Listar' para 'Esconder' e torna a variável booleana bool verdadeira
      button.innerHTML = 'esconder'
      bool = true;
    } else { //Caso a varíavel bool seja verdadeira
      //Remove os elementos da tabela (como se escondendo-os), torna o botão para 'Listar' e torna a variável bool falsa
      table.removeChild(table.lastElementChild);
      button.innerHTML = 'listar'
      bool = false;
    }

  }
  async function delete_tuplas() {
    let name_delete = document.getElementById("nome_delete_grupo").value; //Varíavel que recebe o nome do grupo a ser deletado

    coluna = ["NOME_ARTISTICO"]; //Coluna identificadora do grupo
    valor = [name_delete]; //Array de valor único com o grupo a ser removido
    
    let success = await eel.delete("GRUPO_ARTISTICO", coluna, valor)(); //Chama a função python para deleção de tupla
    
    if (success == 1) {
      alert("Erro ao deletar o registro, tente novamente");
    } else {
      alert('Remoção realizada com sucesso!')
    }
  }
  async function insert_tuplas() {

    //Recepção das variáveis do forms de inserção, as tuplas das redes sociais funcionam como o explicado em atualiza_tuplas()
    let name = document.getElementById("nome_grupo").value;
    let email = document.getElementById("email_grupo").value;
    let desc = document.getElementById("descricao_grupo").value;
    let qtd = document.getElementById("qtd_grupo").value;
    let facebook = document.getElementById("facebook_grupo").value;
    facebook = true ? facebook : 'None';
    let instagram = document.getElementById("instagram_grupo").value;
    instagram = true ? instagram : 'None';
    let twitter = document.getElementById("twitter_grupo").value;
    twitter = true ? twitter : 'None';
    let foto = document.getElementById("img_grupo").value;

    values = [name, desc, facebook, instagram, twitter, email, qtd, foto];
    
    //Chama a função para a inserção da linha, tendo values a array com os valores inseridos
    let success = await eel.insert("GRUPO_ARTISTICO", values)();
    // alert(success);
    if (success == 1) {
      alert("Erro ao inserir o novo registro, tente novamente");
    } else {
      alert('Inserido com sucesso!')
    }
  }
</script>

</html>